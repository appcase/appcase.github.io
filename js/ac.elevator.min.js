let eg={gplay:{},gsets:{},showFScreen:function(){eg.gplay.fullscreen?(document.exitFullscreen(),eg.gplay.fullscreen=!1,$(".fscr").removeClass("fa-compress").addClass("fa-expand")):(document.documentElement.requestFullscreen(),eg.gplay.fullscreen=!0,$(".fscr").removeClass("fa-expand").addClass("fa-compress"))},showModal:function(e){$(".modal").load("./pages/"+e).show()},hideModal:function(){$(".modal").html("").hide(),eg.gplay.flrtapped=-3,eg.gplay.eletapped=-3},hideElevatorModal:function(){$(".modal").html("").hide(),eg.gplay.eletapped=-3,eg.gplay.flrtapped>=0&&eg.showModal("floor.html")},randomInteger:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},resetGame:function(){951==prompt("Resetting the game will delete all the progress of the current play. Do you want to reset?\n\nPlease confirm your action by entering 951 in the input box below.")&&(eg.gplay.eAgent&&clearInterval(eg.gplay.eAgent),localStorage.removeItem("elevator.gsets"),localStorage.removeItem("elevator.gplay"),$(".ppicon").removeClass("fa-pause").addClass("fa-play").next().next().text("Start Game"),eg.toastMessage("Game reset complete!<br>Please start game.",1500),eg.loadFromLocal())},playGame:function(e){$(e).hasClass("fa-play")?"end"!=eg.gplay.status?(eg.gplay.eAgent||(eg.gplay.eAgent=setInterval(eg.runAgent,eg.gsets.eTimer)),$(e).removeClass("fa-play").addClass("fa-pause").next().next().text("Pause Game"),eg.toastMessage("Get Ready!<br>Visitors arriving soon...",1500)):eg.toastMessage("Game Over!<br>Please restart.",5e3):(eg.gplay.eAgent&&clearInterval(eg.gplay.eAgent),eg.gplay.eAgent=null,$(e).removeClass("fa-pause").addClass("fa-play").next().next().text("Resume Game"),eg.toastMessage("Game paused!",1500))},toastMessage:function(e,t){$("#message").html(e).show(),setTimeout(function(){$("#message").text("").hide()},t)},loadFromLocal:function(){eg.gsets=JSON.parse(localStorage.getItem("elevator.gsets")),eg.gplay=JSON.parse(localStorage.getItem("elevator.gplay")),eg.gsets||(eg.gsets={floors:10,elevators:7,eTimer:3e3,fTimer:7}),eg.gplay||(eg.gplay={floors:[],elevators:[],history:[],pmoved:0,itwait:0,twait:0,wratio:0,status:"play"}),eg.gplay.eAgent=null,eg.gplay.fullscreen=!1,eg.gplay.eAgentRun||(eg.gplay.eAgentRun=eg.gsets.fTimer),eg.gplay.flrtapped=-3,eg.gplay.eletapped=-3,eg.setupGame()},setupGame:function(){let e='<table id="statTab"><tr><td>Visitors Moved: '+eg.gplay.pmoved+"</td><td>Op Ratio: "+eg.gplay.wratio+"</td></tr></table>";e+='<table id="elevators">';for(let t=eg.gsets.floors;t>=0;t--){e+="<tr>";for(let l=0;l<=eg.gsets.elevators;l++)0==l?(0==t&&(e+='<td onclick="eg.showFDetails(this);">&nbsp;<b>F: 0</b><b><span class="fvnone vcount">0</span></b></td>'),0!=t&&(e+='<td onclick="eg.showFDetails(this);">&nbsp;<b>F: '+t+'</b><b><span class="fvnone vcount">0</span></b></td>')):e+='<td onclick="eg.showEDetails(this);">&nbsp;</td>';e+="</tr>"}e+='</table><br><div class="purple">Check <i class="fas fa-lg fa-question-circle lime" onclick="eg.showModal(\'help.html\')"></i> for game instructions.</div>',$("#appbody").html(e),$(".vcount").off("fill").on("fill",function(){parseInt($(this).text())>0&&$(this).removeClass("fvpres fvnone").addClass("fvpres"),0==parseInt($(this).text())&&$(this).removeClass("fvpres fvnone").addClass("fvnone")});let t=$("#elevators tr:last").position();if($("#appbody").scrollTop(t.top),0==eg.gplay.floors.length)for(let e=eg.gsets.floors;e>=0;e--)eg.gplay.floors.push({id:e,ctotal:0,visitorsU:[],visitorsD:[],runvid:0});else for(let e=0;e<eg.gplay.floors.length;e++)$("#elevators tr:eq("+e+") td:eq(0) span").text(eg.gplay.floors[e].ctotal);if($(".vcount").trigger("fill"),0==eg.gplay.elevators.length)for(let e=0;e<eg.gsets.elevators;e++)eg.gplay.elevators.push({mode:"S",maxweight:1500,curFloorIndex:eg.gsets.floors,totweight:0,visitorsU:[],visitorsD:[]});eg.updateElePanel(),localStorage.setItem("elevator.gsets",JSON.stringify(eg.gsets)),localStorage.setItem("elevator.gplay",JSON.stringify(eg.gplay))},runAgent:function(){eg.calcWait(),eg.gplay.eAgentRun==eg.gsets.fTimer&&(eg.generateFCrowd(),eg.gplay.eAgentRun=0),eg.exeEleLogic(),eg.updateElePanel(),eg.gplay.flrtapped>=0&&eg.showDetailsFlr(),eg.gplay.eletapped>=0&&eg.showDetailsEle(),eg.gplay.eAgentRun++,localStorage.setItem("elevator.gsets",JSON.stringify(eg.gsets)),localStorage.setItem("elevator.gplay",JSON.stringify(eg.gplay)),"end"==eg.gplay.status&&(eg.gplay.eAgent&&clearInterval(eg.gplay.eAgent),eg.toastMessage("Game Over!",5e3),$(".ppicon").removeClass("fa-pause").addClass("fa-play").next().next().text("Start Game"))},calcWait:function(){for(let e=0;e<eg.gplay.floors.length;e++){for(let t=0;t<eg.gplay.floors[e].visitorsU.length;t++)eg.gplay.floors[e].visitorsU[t].qwait+=eg.gsets.eTimer/1e3;for(let t=0;t<eg.gplay.floors[e].visitorsD.length;t++)eg.gplay.floors[e].visitorsD[t].qwait+=eg.gsets.eTimer/1e3}for(let e=0;e<eg.gplay.elevators.length;e++){for(let t=0;t<eg.gplay.elevators[e].visitorsU.length;t++)eg.gplay.elevators[e].visitorsU[t].qwait+=eg.gsets.eTimer/1e3;for(let t=0;t<eg.gplay.elevators[e].visitorsD.length;t++)eg.gplay.elevators[e].visitorsD[t].qwait+=eg.gsets.eTimer/1e3}},generateFCrowd:function(){let e=eg.randomInteger(1,eg.gsets.elevators/2),t=eg.randomInteger(0,eg.gsets.floors-1),l=eg.randomInteger(0,eg.gsets.elevators/2),s=eg.randomInteger(0,eg.gsets.elevators/2);for(let t=1;t<=e;t++){let e=eg.gplay.floors.length-1;eg.gplay.floors[e].runvid++,eg.gplay.floors[e].ctotal++;let t=eg.randomInteger(1,eg.gsets.floors);eg.gplay.floors[e].visitorsU.unshift({id:eg.gplay.floors[e].id+"|"+eg.gplay.floors[e].runvid,assignedE:"X",dir:"U",qwait:0,iwait:eg.gsets.eTimer*(eg.randomInteger(5,9)+e-(e-t))/1e3,weight:eg.randomInteger(3,100),fromF:0,toF:t,fromI:e,toI:e-t}),$("#elevators tr:eq("+eg.gsets.floors+") td:eq(0) span").text(eg.gplay.floors[e].ctotal)}if(t>0)for(let e=1;e<=l;e++){eg.gplay.floors[t].runvid++,eg.gplay.floors[t].ctotal++;let e=eg.randomInteger(eg.gsets.floors-t+1,eg.gsets.floors);eg.gplay.floors[t].visitorsU.unshift({id:eg.gplay.floors[t].id+"|"+eg.gplay.floors[t].runvid,assignedE:"X",dir:"U",qwait:0,iwait:eg.gsets.eTimer*(eg.randomInteger(5,9)+t-(eg.gplay.floors.length-1-e))/1e3,weight:eg.randomInteger(3,100),fromF:eg.gsets.floors-t,toF:e,fromI:t,toI:eg.gplay.floors.length-1-e})}for(let e=1;e<=s;e++){eg.gplay.floors[t].runvid++,eg.gplay.floors[t].ctotal++;let e=eg.randomInteger(0,eg.gsets.floors-t-1);eg.gplay.floors[t].visitorsD.unshift({id:eg.gplay.floors[t].id+"|"+eg.gplay.floors[t].runvid,assignedE:"X",dir:"D",qwait:0,iwait:eg.gsets.eTimer*(eg.randomInteger(5,9)+(eg.gplay.floors.length-1-e)-t)/1e3,weight:eg.randomInteger(3,100),fromF:eg.gsets.floors-t,toF:e,fromI:t,toI:eg.gplay.floors.length-1-e})}$("#elevators tr:eq("+t+") td:eq(0) span").text(eg.gplay.floors[t].ctotal),$(".vcount").trigger("fill");for(let e=0;e<eg.gplay.floors.length;e++)if(eg.gplay.floors[e].ctotal>50){eg.gplay.status="end";break}},exeEleLogic:function(){if($("#statTab tr td:eq(0)").text("Visitors Moved: "+eg.gplay.pmoved),eg.gplay.wratio=eg.gplay.itwait>0?(eg.gplay.twait/eg.gplay.itwait).toFixed(3):0,$("#statTab tr td:eq(1)").text("Op Ratio: "+eg.gplay.wratio),eg.gplay.wratio>10)eg.gplay.status="end";else for(let e=0;e<eg.gplay.elevators.length;e++)if("S"!=eg.gplay.elevators[e].mode)if("M"!=eg.gplay.elevators[e].mode);else{let t=eg.gplay.elevators[e].dir,l=eg.gplay.elevators[e].curFloorIndex;(l="U"==t?Math.min(l-1,eg.gsets.floors):Math.max(l+1,0))<0&&(l=0),l>eg.gsets.floors&&(l=eg.gsets.floors),eg.gplay.elevators[e].curFloorIndex=l;let s=!1;for(let t=eg.gplay.elevators[e].visitorsU.length-1;t>=0;t--)eg.gplay.elevators[e].visitorsU[t].toI==l&&(s=!0);for(let t=eg.gplay.elevators[e].visitorsD.length-1;t>=0;t--)eg.gplay.elevators[e].visitorsD[t].toI==l&&(s=!0);for(let t=eg.gplay.floors[l].visitorsU.length-1;t>=0;t--)eg.gplay.floors[l].visitorsU[t].assignedE==e&&eg.gplay.elevators[e].totweight+eg.gplay.floors[l].visitorsU[t].weight<=eg.gplay.elevators[e].maxweight&&(s=!0);for(let t=eg.gplay.floors[l].visitorsD.length-1;t>=0;t--)eg.gplay.floors[l].visitorsD[t].assignedE==e&&eg.gplay.elevators[e].totweight+eg.gplay.floors[l].visitorsD[t].weight<=eg.gplay.elevators[e].maxweight&&(s=!0);s&&(eg.gplay.elevators[e].mode="S"),eg.gplay.elevators[e].eicon="fa-columns"}else{let t=0;eg.gplay.elevators[e].totweight=0;for(let l=eg.gplay.elevators[e].visitorsU.length-1;l>=0;l--)eg.gplay.elevators[e].visitorsU[l].toI==eg.gplay.elevators[e].curFloorIndex&&++t<=5?(eg.gplay.pmoved++,$("#statTab tr td:eq(0)").text("Visitors Moved: "+eg.gplay.pmoved),eg.gplay.itwait+=eg.gplay.elevators[e].visitorsU[l].iwait,eg.gplay.twait+=eg.gplay.elevators[e].visitorsU[l].qwait,eg.gplay.elevators[e].visitorsU.splice(l,1)):eg.gplay.elevators[e].totweight+=eg.gplay.elevators[e].visitorsU[l].weight;if(t<5)for(let l=eg.gplay.elevators[e].visitorsD.length-1;l>=0;l--)eg.gplay.elevators[e].visitorsD[l].toI==eg.gplay.elevators[e].curFloorIndex&&++t<=5?(eg.gplay.pmoved++,$("#statTab tr td:eq(0)").text("Visitors Moved: "+eg.gplay.pmoved),eg.gplay.itwait+=eg.gplay.elevators[e].visitorsD[l].iwait,eg.gplay.twait+=eg.gplay.elevators[e].visitorsD[l].qwait,eg.gplay.elevators[e].visitorsD.splice(l,1)):eg.gplay.elevators[e].totweight+=eg.gplay.elevators[e].visitorsD[l].weight;let l=eg.gplay.elevators[e].curFloorIndex;for(let t=eg.gplay.floors[l].visitorsU.length-1;t>=0;t--)if(eg.gplay.floors[l].visitorsU[t].assignedE==e&&eg.gplay.elevators[e].totweight+eg.gplay.floors[l].visitorsU[t].weight<=eg.gplay.elevators[e].maxweight){let s=eg.gplay.floors[l].visitorsU.splice(t,1)[0];eg.gplay.elevators[e].visitorsU.unshift(s),eg.gplay.elevators[e].totweight+=s.weight}for(let t=eg.gplay.floors[l].visitorsD.length-1;t>=0;t--)if(eg.gplay.floors[l].visitorsD[t].assignedE==e&&eg.gplay.elevators[e].totweight+eg.gplay.floors[l].visitorsD[t].weight<=eg.gplay.elevators[e].maxweight){let s=eg.gplay.floors[l].visitorsD.splice(t,1)[0];eg.gplay.elevators[e].visitorsD.unshift(s),eg.gplay.elevators[e].totweight+=s.weight}eg.gplay.floors[l].ctotal=eg.gplay.floors[l].visitorsU.length+eg.gplay.floors[l].visitorsD.length,$("#elevators tr:eq("+l+") td:eq(0) span").text(eg.gplay.floors[l].ctotal),$(".vcount").trigger("fill");let s=!0;if(0==eg.gplay.elevators[e].visitorsU.length&&0==eg.gplay.elevators[e].visitorsD.length){let t=!1;for(let l=0;l<eg.gplay.floors.length;l++){for(let s=0;s<eg.gplay.floors[l].visitorsU.length;s++)eg.gplay.floors[l].visitorsU[s].assignedE==e&&(t=!0);for(let s=0;s<eg.gplay.floors[l].visitorsD.length;s++)eg.gplay.floors[l].visitorsD[s].assignedE==e&&(t=!0)}s=t}else{for(let t=0;t<eg.gplay.elevators[e].visitorsU.length;t++)eg.gplay.elevators[e].visitorsU[t].toI==l&&(s=!1);for(let t=0;t<eg.gplay.elevators[e].visitorsD.length;t++)eg.gplay.elevators[e].visitorsD[t].toI==l&&(s=!1)}s&&(eg.gplay.elevators[e].mode="M",eg.gplay.elevators[e].eicon="fa-door-closed")}},updateElePanel:function(){for(let e=0;e<eg.gplay.elevators.length;e++){for(let t=0;t<eg.gplay.floors.length;t++)t==eg.gsets.floors?$("#elevators").find("tr:eq("+t+")").find("td:eq("+(e+1)+")").html('<i class="fas fa-sm fa-doors-closed red"></i><br><b>E-'+(e+1)+"</b>"):$("#elevators").find("tr:eq("+t+")").find("td:eq("+(e+1)+")").html("&nbsp;");let t=eg.gplay.elevators[e].curFloorIndex,l=eg.gsets.floors-t,s="";if("S"==eg.gplay.elevators[e].mode)eg.gplay.elevators[e].dir="",t==eg.gsets.floors?$("#elevators").find("tr:eq("+t+")").find("td:eq("+(e+1)+")").html('<i class="fas fa-sm fa-door-open red"></i><br><b>E-'+(e+1)+'</b><br><span class="elepanel">'+l+"</span>"):$("#elevators").find("tr:eq("+t+")").find("td:eq("+(e+1)+")").html('<i class="fas fa-sm fa-door-open red"></i>');else{let o="";if(0==eg.gplay.elevators[e].visitorsU.length&&0==eg.gplay.elevators[e].visitorsD.length)for(let l=0;l<eg.gplay.floors.length;l++){for(let s=0;s<eg.gplay.floors[l].visitorsU.length;s++)eg.gplay.floors[l].visitorsU[s].assignedE==e&&(eg.gplay.floors[l].visitorsU[s].fromI>t&&(o="D"),eg.gplay.floors[l].visitorsU[s].fromI<t&&(o="U"));if(""==o)for(let s=0;s<eg.gplay.floors[l].visitorsD.length;s++)eg.gplay.floors[l].visitorsD[s].assignedE==e&&(eg.gplay.floors[l].visitorsD[s].fromI>t&&(o="D"),eg.gplay.floors[l].visitorsD[s].fromI<t&&(o="U"))}else eg.gplay.elevators[e].visitorsU.length<eg.gplay.elevators[e].visitorsD.length&&(o="D"),eg.gplay.elevators[e].visitorsU.length>=eg.gplay.elevators[e].visitorsD.length&&(o="U");eg.gplay.elevators[e].dir=o,"U"==o&&(s="fa-arrow-up"),"D"==o&&(s="fa-arrow-down"),t==eg.gsets.floors?$("#elevators").find("tr:eq("+t+")").find("td:eq("+(e+1)+")").html('<i class="fas fa-sm fa-door-closed red"></i><br><b>E-'+(e+1)+'</b><br><span class="elepanel">'+l+'&nbsp;<i class="fas fa-sm '+s+' lime"></i></span>'):$("#elevators").find("tr:eq("+t+")").find("td:eq("+(e+1)+")").html('<i class="fas fa-sm '+eg.gplay.elevators[e].eicon+' red"></i>')}$("#elevators").find("tr:eq("+eg.gsets.floors+")").find("td:eq("+(e+1)+")").html('<i class="fas fa-sm fa-door-closed red"></i><br><b>E-'+(e+1)+'</b><br><span class="elepanel">'+l+'&nbsp;<i class="fas fa-sm '+s+' lime"></i></span>')}},showDetailsFlr:function(){$(".navappnameflr").text("Floor "+parseInt(eg.gsets.floors-eg.gplay.flrtapped)+" Details");let e='<table id="flrDetails"><tr style="position:sticky;top:3px;">',t=eg.gplay.floors[eg.gplay.flrtapped].visitorsU?eg.gplay.floors[eg.gplay.flrtapped].visitorsU.length:0,l=eg.gplay.floors[eg.gplay.flrtapped].visitorsD?eg.gplay.floors[eg.gplay.flrtapped].visitorsD.length:0;e+='<td style="text-align:center;"><b>Visitors<br>'+parseInt(t+l)+"</b></td>";for(let t=0;t<eg.gplay.elevators.length;t++){let l=eg.gsets.floors-eg.gplay.elevators[t].curFloorIndex,s=eg.gplay.elevators[t].dir;eg.gplay.elevators[t].dir?("U"==eg.gplay.elevators[t].dir&&(s="U"),"D"==eg.gplay.elevators[t].dir&&(s="D")):s="";let o="";"U"==s&&(o="fa-arrow-up"),"D"==s&&(o="fa-arrow-down"),e+='<td class="elepanel" style="color:black;" onclick="eg.showEDetails(this);"><i class="fas fa-sm fa-door-closed red"></i><br><span><b>E-'+(t+1)+"</b></span><br><span>"+l+'&nbsp;<i class="fas fa-sm '+o+' lime"></i></span></td>'}e+="</tr>";for(let t=0;t<=1;t++){let l="visitorsU",s="fa-arrow-circle-up red";1==t&&(l="visitorsD",s="fa-arrow-circle-down blue");for(let o=eg.gplay.floors[eg.gplay.flrtapped][l].length-1;o>=0;o--){e+='<tr><td style="width:23%;text-align:left;font-size:15px;padding-left:1px;"><table style="width:100%;"><tr><td colspan=2 style="border:0;text-align:center;font-family:Orbitron;font-size:14px;font-weight:bold;">'+eg.gplay.floors[eg.gplay.flrtapped][l][o].id+'</td></tr><tr><td style="border:0;text-align:center;"><i class="fas fa-lg '+s+'"></td><td style="border:0;"><span style="background-color:yellow;font-family:Orbitron;font-size:14px;"><b>'+eg.gplay.floors[eg.gplay.flrtapped][l][o].fromF+" - "+eg.gplay.floors[eg.gplay.flrtapped][l][o].toF+'</b></span></td></tr><tr><td style="border:0;text-align:center;"><i class="fas fa-sm fa-stopwatch purple"></i></td><td style="border:0;font-family:Orbitron;font-size:12px;"><b>'+eg.gplay.floors[eg.gplay.flrtapped][l][o].qwait+"/"+eg.gplay.floors[eg.gplay.flrtapped][l][o].iwait+'</b></td></tr><tr><td style="border:0;text-align:center;"><i class="fas fa-sm fa-weight purple"></i></td><td style="border:0;font-family:Orbitron;font-size:12px;"><b>'+eg.gplay.floors[eg.gplay.flrtapped][l][o].weight+"</b></td></tr></table></td>";for(let s=0;s<eg.gplay.elevators.length;s++){e+='<td style="width:11%;cursor:pointer; background-color:'+(s==eg.gplay.floors[eg.gplay.flrtapped][l][o].assignedE?"lightgreen":"transparent")+';" onclick="eg.assignEle('+t+",'"+eg.gplay.floors[eg.gplay.flrtapped][l][o].id+"', this);\">&nbsp;</td>"}e+="</tr>"}}e+="</table>",$(".modalbodybnavflr div:eq(0)").html(e)},showDetailsEle:function(){let e=eg.gplay.eletapped-1;$(".navappnameele").text("Elevator E-"+eg.gplay.eletapped+" Details"),$(".modalbodybnavele div div:eq(0)").html("Weight<br>"+eg.gplay.elevators[e].totweight+"/"+eg.gplay.elevators[e].maxweight);let t=eg.gsets.floors-eg.gplay.elevators[e].curFloorIndex,l="U";eg.gplay.elevators[e].dir?"D"==eg.gplay.elevators[e].dir&&(l="D"):l="";let s="";"U"==l&&(s="fa-arrow-up"),"D"==l&&(s="fa-arrow-down"),$(".modalbodybnavele div div:eq(1)").html("Floor<br>"+t+'&nbsp;<i class="fas fa-sm '+s+' red"></i>'),$(".modalbodybnavele div div:eq(1)").data("floor",eg.gplay.elevators[e].curFloorIndex);let o=eg.gplay.elevators[e].visitorsU?eg.gplay.elevators[e].visitorsU.length:0,a=eg.gplay.elevators[e].visitorsD?eg.gplay.elevators[e].visitorsD.length:0;$(".modalbodybnavele div div:eq(2)").html("Person<br>"+parseInt(o+a));let g='<table style="width:100%;font-weight:normal;font-size:12px;font-family:Orbitron;"><tr><td style="width:20%;background-color:#333;color:white;">Visitor</td><td style="width:15%;background-color:#333;color:white;">From</td><td style="width:15%;background-color:#333;color:white;">To</td><td style="width:15%;background-color:#333;color:white;">Weight</td><td style="width:35%;background-color:#333;color:white;">Wait</td></tr>';for(let t=0;t<=1;t++){let l="visitorsU";1==t&&(l="visitorsD");for(let t=0;t<eg.gplay.elevators[e][l].length;t++)g+="<tr><td>"+eg.gplay.elevators[e][l][t].id+"</td><td>"+eg.gplay.elevators[e][l][t].fromF+"</td><td>"+eg.gplay.elevators[e][l][t].toF+"</td><td>"+eg.gplay.elevators[e][l][t].weight+"</td><td>"+eg.gplay.elevators[e][l][t].qwait+" / "+eg.gplay.elevators[e][l][t].iwait+"</td></tr>"}g+="</table>",$(".elepassengers").html(g)},showEDetails:function(e){eg.gplay.eletapped=$(e).closest("td").index(),eg.showModal("elevator.html")},showFDetails:function(e){eg.gplay.flrtapped=$(e).closest("tr").index(),eg.showModal("floor.html")}};$(document).ready(function(){$(".modal")[0].style.display="none",eg.loadFromLocal()});